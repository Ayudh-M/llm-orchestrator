{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["tag","status"],
  "properties": {
    "tag": { "type":"string", "pattern":"^\[(CONTACT|SOLVED)\]$" },
    "status": { "type":"string", "enum":["WORKING","NEED_PEER","PROPOSED","READY_TO_SOLVE","SOLVED"] },
    "content": { "type":"object" },
    "final_solution": {
      "type":"object",
      "required":["canonical_text"],
      "properties": {
        "canonical_text": { "type":"string", "minLength":1 },
        "sha256": { "type":"string", "pattern":"^[0-9a-f]{64}$" }
      },
      "additionalProperties": false
    }
  },
  "allOf": [
    { "if": { "properties": { "status": { "const":"SOLVED" } } },
      "then": { "required": ["final_solution"] } },
    { "if": { "properties": { "status": { "not": { "const":"SOLVED" } } } },
      "then": { "not": { "required": ["final_solution"] } } }
  ],
  "additionalProperties": true
}
